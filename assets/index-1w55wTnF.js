(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function c(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?e.credentials="include":n.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(n){if(n.ep)return;n.ep=!0;const e=c(n);fetch(n.href,e)}})();var K=1e-6,O=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function G(){var t=new O(16);return O!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function V(t,r,c,l){var n=l[0],e=l[1],a=l[2],u=Math.hypot(n,e,a),m,T,E,R,x,g,p,_,b,v,S,L,y,U,I,h,o,s,i,d,f,A,P,M;return u<K?null:(u=1/u,n*=u,e*=u,a*=u,m=Math.sin(c),T=Math.cos(c),E=1-T,R=r[0],x=r[1],g=r[2],p=r[3],_=r[4],b=r[5],v=r[6],S=r[7],L=r[8],y=r[9],U=r[10],I=r[11],h=n*n*E+T,o=e*n*E+a*m,s=a*n*E-e*m,i=n*e*E-a*m,d=e*e*E+T,f=a*e*E+n*m,A=n*a*E+e*m,P=e*a*E-n*m,M=a*a*E+T,t[0]=R*h+_*o+L*s,t[1]=x*h+b*o+y*s,t[2]=g*h+v*o+U*s,t[3]=p*h+S*o+I*s,t[4]=R*i+_*d+L*f,t[5]=x*i+b*d+y*f,t[6]=g*i+v*d+U*f,t[7]=p*i+S*d+I*f,t[8]=R*A+_*P+L*M,t[9]=x*A+b*P+y*M,t[10]=g*A+v*P+U*M,t[11]=p*A+S*P+I*M,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function $(t,r,c,l,n){var e=1/Math.tan(r/2),a;return t[0]=e/c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!==1/0?(a=1/(l-n),t[10]=(n+l)*a,t[14]=2*n*l*a):(t[10]=-1,t[14]=-2*l),t}var Q=$;document.getElementById("app").innerHTML=`
  <canvas id="panoramaCanvas"></canvas>
`;const J=document.getElementById("panoramaCanvas"),Z=Array.from({length:50},(t,r)=>`tiles/${r+1}.jpg`);setTimeout(()=>{const t=k(J,Z);t.yaw=90,t.fov=100},10);function k(t,r){const c=window.devicePixelRatio||1;let l=1,n=1;_();const e=t.getContext("webgl");if(!e){console.error("WebGL not supported");return}const a=b(),u=S(a),m=ee(30,30),T=L(m),E=y(r);let R=!1,x=0,g=0,p=w(90);U(),I(),window.addEventListener("resize",()=>{_(),h()}),h();function _(){const o=t.parentElement;l=o.clientWidth*c,n=o.clientHeight*c,t.width=l,t.height=n}function b(){const o=`
      attribute vec4 aVertexPosition;
      attribute vec2 aTextureCoord;
      varying highp vec2 vTextureCoord;
      uniform mat4 uModelViewMatrix;
      uniform mat4 uProjectionMatrix;
      void main(void) {
        gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
        vTextureCoord = aTextureCoord;
      }
    `,s=`
      varying highp vec2 vTextureCoord;
      uniform sampler2D uSampler;
      void main(void) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
      }
    `,i=v(e.VERTEX_SHADER,o),d=v(e.FRAGMENT_SHADER,s),f=e.createProgram();return e.attachShader(f,i),e.attachShader(f,d),e.linkProgram(f),e.getProgramParameter(f,e.LINK_STATUS)?f:(console.error("Unable to initialize the shader program: "+e.getProgramInfoLog(f)),null)}function v(o,s){const i=e.createShader(o);return e.shaderSource(i,s),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.error("An error occurred compiling the shaders: "+e.getShaderInfoLog(i)),e.deleteShader(i),null)}function S(o){return{program:o,attribLocations:{vertexPosition:e.getAttribLocation(o,"aVertexPosition"),textureCoord:e.getAttribLocation(o,"aTextureCoord")},uniformLocations:{projectionMatrix:e.getUniformLocation(o,"uProjectionMatrix"),modelViewMatrix:e.getUniformLocation(o,"uModelViewMatrix"),uSampler:e.getUniformLocation(o,"uSampler")}}}function L(o){const s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o.positions),e.STATIC_DRAW);const i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o.textureCoordinates),e.STATIC_DRAW);const d=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(o.indices),e.STATIC_DRAW),{position:s,textureCoord:i,indices:d}}function y(o){const s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const i=0,d=e.RGBA,f=1,A=1,P=0,M=e.RGBA,j=e.UNSIGNED_BYTE,z=new Uint8Array([0,0,0,255]);e.texImage2D(e.TEXTURE_2D,i,d,f,A,P,M,j,z);const D=document.createElement("canvas");D.width=3e3*c,D.height=1500*c;const F=D.getContext("2d");F.fillStyle="rgba(0, 0, 0, 0)",F.imageSmoothingEnabled=!0,F.imageSmoothingQuality="high";const C=new Image;return C.src="./panorama_thumb.jpeg",C.onload=()=>{F.drawImage(C,0,0,3e3*c,1500*c),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,D),N(C.width)&&N(C.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),h(),o.map(Y=>{const B=new Image;B.onload=()=>{const{x:H,y:q}=te(Y);F.drawImage(B,(9-H)*300*c,(4-q)*300*c,300*c,300*c),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,D),N(B.width)&&N(B.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),h()},B.src=Y})},s}function U(){let o=0,s=0;t.addEventListener("pointerdown",i=>{i.button===0&&(i.preventDefault(),R=!0,t.style.cursor="all-scroll",o=i.clientX,s=i.clientY)}),document.addEventListener("pointermove",i=>{if(!R)return;i.preventDefault();const d=i.clientX-o,f=i.clientY-s,A=.005*(90/(p*180/Math.PI));x-=d*A,g-=f*A;const P=Math.PI/2,M=-Math.PI/2;g=W(g,M,P),o=i.clientX,s=i.clientY,h()}),document.addEventListener("pointerup",()=>{R=!1,t.style.cursor=null})}function I(){t.addEventListener("wheel",o=>{o.preventDefault(),p+=o.deltaY*.1*(Math.PI/180),p=W(p,w(30),w(120)),h()})}function h(){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);const o=l/n,s=.1,i=100,d=G();e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),Q(d,p,o,s,i);const f=G();V(f,f,g,[1,0,0]),V(f,f,x,[0,1,0]),e.bindBuffer(e.ARRAY_BUFFER,T.position),e.vertexAttribPointer(u.attribLocations.vertexPosition,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(u.attribLocations.vertexPosition),e.bindBuffer(e.ARRAY_BUFFER,T.textureCoord),e.vertexAttribPointer(u.attribLocations.textureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(u.attribLocations.textureCoord),e.useProgram(u.program),e.uniformMatrix4fv(u.uniformLocations.projectionMatrix,!1,d),e.uniformMatrix4fv(u.uniformLocations.modelViewMatrix,!1,f),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,E),e.uniform1i(u.uniformLocations.uSampler,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,T.indices),e.drawElements(e.TRIANGLES,m.indexCount,e.UNSIGNED_SHORT,0)}return{get yaw(){return X(x)},set yaw(o){x=w(o),h()},get pitch(){return X(g)},set pitch(o){g=w(o),h()},get fov(){return X(p)},set fov(o){p=w(o),h()}}}function ee(t,r){const c=[],l=[],n=[];for(let e=0;e<=t;e++){const a=e*Math.PI/t,u=Math.sin(a),m=Math.cos(a);for(let T=0;T<=r;T++){const E=T*2*Math.PI/r,R=Math.sin(E),g=Math.cos(E)*u,p=m,_=R*u,b=1-T/r,v=e/t;c.push(g,p,_),l.push(b,v)}}for(let e=0;e<t;e++)for(let a=0;a<r;a++){const u=e*(r+1)+a,m=u+r+1;n.push(u,m,u+1),n.push(m,m+1,u+1)}return{positions:c,textureCoordinates:l,indices:n,indexCount:n.length}}function N(t){return(t&t-1)===0}function w(t){return t*Math.PI/180}function X(t){return t*180/Math.PI}function W(t,r,c){return Math.max(r,Math.min(c,t))}function te(t){const r=t.match(/tiles\/(\d+)\.jpg$/);if(r){const c=parseInt(r[1],10)-1,l=c%10,n=Math.floor(c/10);return{x:l,y:n}}return{x:0,y:0}}
